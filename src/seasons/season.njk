---
layout: base.njk
pagination:
    data: site.years
    size: 1
    alias: year
permalink: "/seasons/{{ year }}/"
eleventyComputed:
    title: "{{ year }} Projection Accuracy"
---

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">{{ year }} Projection Evaluation</h1>
    </div>

    <!-- Chart Grid -->
    <div class="space-y-8 mb-8">
        <!-- Batting Section -->
        <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Batting Projection Accuracy</h2>

            <!-- 1. Batting PA Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting PA MAE</h3>
                    <div class="h-80"><canvas id="battingVolumeMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting PA RMSE</h3>
                    <div class="h-80"><canvas id="battingVolumeRmseChart"></canvas></div>
                </div>
            </div>

            <!-- 2. Batting Weighted League-Adjusted Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate Weighted League-Adjusted MAE</h3>
                    <div class="h-80"><canvas id="battingRateWLAMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate Weighted League-Adjusted RMSE</h3>
                    <div class="h-80"><canvas id="battingRateWLARmseChart"></canvas></div>
                </div>
            </div>

            <!-- 3. Batting League-Adjusted Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate League-Adjusted MAE</h3>
                    <div class="h-80"><canvas id="battingRateLeagueAdjMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate League-Adjusted RMSE</h3>
                    <div class="h-80"><canvas id="battingRateLeagueAdjRmseChart"></canvas></div>
                </div>
            </div>

            <!-- 4. Batting Raw Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate MAE</h3>
                    <div class="h-80"><canvas id="battingRateMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Batting Rate RMSE</h3>
                    <div class="h-80"><canvas id="battingRateRmseChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Pitching Section -->
        <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Pitching Projection Accuracy</h2>

            <!-- 5. Pitching BF Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching BF MAE</h3>
                    <div class="h-80"><canvas id="pitchingVolumeMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching BF RMSE</h3>
                    <div class="h-80"><canvas id="pitchingVolumeRmseChart"></canvas></div>
                </div>
            </div>

            <!-- 6. Pitching Weighted League-Adjusted Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate Weighted League-Adjusted MAE</h3>
                    <div class="h-80"><canvas id="pitchingRateWLAMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate Weighted League-Adjusted RMSE</h3>
                    <div class="h-80"><canvas id="pitchingRateWLARmseChart"></canvas></div>
                </div>
            </div>

            <!-- 7. Pitching League-Adjusted Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate League-Adjusted MAE</h3>
                    <div class="h-80"><canvas id="pitchingRateLeagueAdjMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate League-Adjusted RMSE</h3>
                    <div class="h-80"><canvas id="pitchingRateLeagueAdjRmseChart"></canvas></div>
                </div>
            </div>

            <!-- 8. Pitching Raw Rate Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate MAE</h3>
                    <div class="h-80"><canvas id="pitchingRateMaeChart"></canvas></div>
                </div>
                <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Pitching Rate RMSE</h3>
                    <div class="h-80"><canvas id="pitchingRateRmseChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biggest Misses Section -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Biggest Misses - {{ year }}</h2>

        {% set yearData = years[year] %}
        {% if yearData %}
            {% set proj_colors = {
                'Marcel': 'text-red-600 dark:text-red-400',
                'Steamer': 'text-indigo-600 dark:text-indigo-400',
                'ZiPS': 'text-green-600 dark:text-green-400'
            } %}
            <!-- Batting Playing-Time Misses -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Batting - Biggest PA Misses</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {% for system in site.meta.projection_systems %}
                    <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                        <h4 class="text-lg font-medium {{ proj_colors[system] or 'text-gray-600 dark:text-gray-400' }} mb-4">{{ system }}</h4>
                        {% set statResults = null %}
                        {% for result in yearData.batting %}
                            {% if result.system == system and result.stat == 'PA' %}
                                {% set statResults = result %}
                            {% endif %}
                        {% endfor %}
                        {% if statResults and statResults.biggest_misses %}
                        <div class="relative overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400">
                                    <tr>
                                        <th scope="col" class="px-4 py-2">Rank</th>
                                        <th scope="col" class="px-4 py-2">Player</th>
                                        <th scope="col" class="px-4 py-2 text-right">Proj</th>
                                        <th scope="col" class="px-4 py-2 text-right">Actual</th>
                                        <th scope="col" class="px-4 py-2 text-right">Error</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for miss in statResults.biggest_misses.slice(0, 10) %}
                                    <tr class="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                        <td class="px-4 py-2 font-medium text-gray-900 dark:text-white font-mono">{{ loop.index }}</td>
                                        <td class="px-4 py-2">
                                            <a href="{{ ('/players/' + miss.player_id + '/') | url }}" class="text-blue-600 dark:text-blue-400 hover:underline">
                                                {{ miss.player_name }}
                                            </a>
                                        </td>
                                        <td class="px-4 py-2 font-mono text-right">{{ miss.projected | toFixed(1) }}</td>
                                        <td class="px-4 py-2 font-mono text-right">{{ miss.actual | toFixed(1) }}</td>
                                        <td class="px-4 py-2 font-semibold text-red-600 dark:text-red-400 font-mono text-right">{{ miss.error | toFixed(1) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-gray-500 dark:text-gray-400">No data available.</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Rate Stats Misses -->
            {% for playerType in ['batting', 'pitching'] %}
            {% set rateStats = ['SO/PA', 'BB/PA', 'HR/PA', 'HBP/PA'] if playerType == 'batting' else ['SO/BF', 'BB/BF', 'HR/BF', 'HBP/BF'] %}
            {% for stat in rateStats %}
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">{{ playerType | title }} - Biggest {{ stat }} Misses (weighted league-adjusted)</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {% for system in site.meta.projection_systems %}
                    <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                        <h4 class="text-lg font-medium {{ proj_colors[system] or 'text-gray-600 dark:text-gray-400' }} mb-4">{{ system }}</h4>
                        {% set statResults = null %}
                        {% for result in yearData[playerType] %}
                            {% if result.system == system and result.stat == stat %}
                                {% set statResults = result %}
                            {% endif %}
                        {% endfor %}
                        {% if statResults and statResults.biggest_misses %}
                        <div class="relative overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400">
                                    <tr>
                                        <th scope="col" class="px-4 py-2">Rank</th>
                                        <th scope="col" class="px-4 py-2">Player</th>
                                        <th scope="col" class="px-4 py-2 text-right">Proj</th>
                                        <th scope="col" class="px-4 py-2 text-right">Actual</th>
                                        <th scope="col" class="px-4 py-2 text-right">Error</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for miss in statResults.biggest_misses.slice(0, 10) %}
                                    <tr class="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                        <td class="px-4 py-2 font-medium text-gray-900 dark:text-white font-mono">{{ loop.index }}</td>
                                        <td class="px-4 py-2">
                                            <a href="{{ ('/players/' + miss.player_id + '/') | url }}" class="text-blue-600 dark:text-blue-400 hover:underline">
                                                {{ miss.player_name }}
                                            </a>
                                        </td>
                                        <td class="px-4 py-2 font-mono text-right">{{ miss.projected | toFixed(3) }}</td>
                                        <td class="px-4 py-2 font-mono text-right">{{ miss.actual | toFixed(3) }}</td>
                                        <td class="px-4 py-2 font-semibold text-red-600 dark:text-red-400 font-mono text-right">{{ miss.error | toFixed(3) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-gray-500 dark:text-gray-400">No data available.</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% endfor %}
        {% endif %}
    </div>

    <!-- Metrics Explanation -->
    <div class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Understanding the Metrics</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-700">
                <h3 class="text-lg font-medium text-red-800 dark:text-red-300 mb-2">Raw Metrics</h3>
                <p class="text-sm text-red-700 dark:text-red-400">Direct comparison between projected and actual values without any adjustments. Shows absolute projection accuracy.</p>
            </div>
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-700">
                <h3 class="text-lg font-medium text-blue-800 dark:text-blue-300 mb-2">League-Adjusted</h3>
                <p class="text-sm text-blue-700 dark:text-blue-400">Adjusts for overall league environment changes between projection and actual seasons. Removes league-wide effects.</p>
            </div>
            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-700">
                <h3 class="text-lg font-medium text-green-800 dark:text-green-300 mb-2">Weighted League-Adjusted</h3>
                <p class="text-sm text-green-700 dark:text-green-400">Further adjusts by weighting players based on playing time. Emphasizes accuracy for players with more opportunities.</p>
            </div>
        </div>
        <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
            <p><strong>MAE (Mean Absolute Error):</strong> Average absolute difference between projected and actual values</p>
            <p><strong>RMSE (Root Mean Square Error):</strong> Square root of average squared differences - penalizes larger errors more heavily</p>
        </div>
    </div>

    <!-- Detailed Results Table -->
    <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Detailed Results - {{ year }}</h2>
        {% if yearData %}
        <div class="relative overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-4 py-3">System</th>
                        <th scope="col" class="px-4 py-3">Type</th>
                        <th scope="col" class="px-4 py-3">Stat</th>
                        <th scope="col" class="px-2 py-3 text-right bg-red-50 dark:bg-red-900/20">Raw<br/>MAE</th>
                        <th scope="col" class="px-2 py-3 text-right bg-red-50 dark:bg-red-900/20">Raw<br/>RMSE</th>
                        <th scope="col" class="px-2 py-3 text-right bg-blue-50 dark:bg-blue-900/20">L-Adj<br/>MAE</th>
                        <th scope="col" class="px-2 py-3 text-right bg-blue-50 dark:bg-blue-900/20">L-Adj<br/>RMSE</th>
                        <th scope="col" class="px-2 py-3 text-right bg-green-50 dark:bg-green-900/20">W-L-Adj<br/>MAE</th>
                        <th scope="col" class="px-2 py-3 text-right bg-green-50 dark:bg-green-900/20">W-L-Adj<br/>RMSE</th>
                        <th scope="col" class="px-4 py-3 text-right">R²</th>
                        <th scope="col" class="px-4 py-3 text-right">Players</th>
                    </tr>
                </thead>
                <tbody>
                    {% for playerType in ['batting', 'pitching'] %}
                    {% for result in yearData[playerType] %}
                    <tr class="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <td class="px-4 py-4 font-medium {{ proj_colors[result.system] or 'text-gray-600 dark:text-gray-400' }}">
                            {{ result.system }}
                        </td>
                        <td class="px-4 py-4 text-gray-600 dark:text-gray-400">{{ result.player_type | title }}</td>
                        <td class="px-4 py-4">{{ result.stat }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-red-50 dark:bg-red-900/20">{{ result.mae | toFixed(4) }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-red-50 dark:bg-red-900/20">{{ result.rmse | toFixed(4) }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-blue-50 dark:bg-blue-900/20">{{ result.la_mae | toFixed(4) }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-blue-50 dark:bg-blue-900/20">{{ result.la_rmse | toFixed(4) }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-green-50 dark:bg-green-900/20">{{ result.wla_mae | toFixed(4) }}</td>
                        <td class="px-2 py-4 font-mono text-right bg-green-50 dark:bg-green-900/20">{{ result.wla_rmse | toFixed(4) }}</td>
                        <td class="px-4 py-4 font-mono text-right">{{ result.r_squared | toFixed(3) }}</td>
                        <td class="px-4 py-4 font-mono text-right">{{ result.n_players }}</td>
                    </tr>
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-gray-500 dark:text-gray-400">No data available for {{ year }}.</p>
        {% endif %}
    </div>
</div>

{% block scripts %}
<script>
    {% include "chart-utils.js" %}
    {% include "season-charts.js" %}
    document.addEventListener('DOMContentLoaded', function() {
        initializeSeasonCharts({{ years[year] | dump | safe }}, {{ site.meta.projection_systems | dump | safe }});
    });
</script>
{% endblock %}

